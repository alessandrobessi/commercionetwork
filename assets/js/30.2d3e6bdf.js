(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{448:function(s,a,t){"use strict";t.r(a);var e=t(56),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"updating-a-validator"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#updating-a-validator"}},[s._v("#")]),s._v(" Updating a validator")]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[s._v("DANGER")]),s._v(" "),t("p",[s._v("If you are a new validator you need follow the "),t("RouterLink",{attrs:{to:"/docs2.1.2/nodes/validator-node-installation.html"}},[t("em",[s._v('"Becoming a validator"')]),s._v(" procedure")]),s._v("."),t("br"),s._v(" "),t("strong",[s._v("DO NOT USE THIS UPDATE PROCEDURES")])],1)]),s._v(" "),t("p",[s._v("This section describes the procedure that needs to be followed in order to update a validator node from one\nversion to another.")]),s._v(" "),t("p",[s._v("For updating will be sent to the validators the type and a brief explanation of the steps to be taken."),t("br"),s._v("\nThis guide contains only a general basic explanation of the procedures to be applied.")]),s._v(" "),t("p",[s._v("In general there are 3 types of updates")]),s._v(" "),t("ul",[t("li",[s._v("Update type "),t("a",{attrs:{href:"#update-type-1-hard-fork"}},[t("code",[s._v("1 - Hard fork")])])]),s._v(" "),t("li",[s._v("Update type "),t("a",{attrs:{href:"#update-type-2-soft-fork"}},[t("code",[s._v("2 - Soft fork")])])]),s._v(" "),t("li",[s._v("Update type "),t("a",{attrs:{href:"#update-type-3-reset-reinstall-chain"}},[t("code",[s._v("3 - Reset/reinstall chain")])])])]),s._v(" "),t("h2",{attrs:{id:"update-type-1-hard-fork"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#update-type-1-hard-fork"}},[s._v("#")]),s._v(" Update type 1 - Hard fork")]),s._v(" "),t("p",[s._v("In this case, the chain state will be preserved from its beginning to a certain point in time.")]),s._v(" "),t("h3",{attrs:{id:"preliminary-risks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preliminary-risks"}},[s._v("#")]),s._v(" Preliminary/Risks")]),s._v(" "),t("p",[s._v("When signalling a required update that should follow this procedure, the following information will\nbe let known to all validators:")]),s._v(" "),t("ol",[t("li",[s._v("A specific block height to stop chain: "),t("code",[s._v("<stop_block_height>")])]),s._v(" "),t("li",[s._v("The new chain software version: "),t("code",[s._v("<new_version>")])]),s._v(" "),t("li",[s._v("A deadline expressed in UTC format")]),s._v(" "),t("li",[s._v("A new genesis_time in UTC format (something like 2020-06-12T08:55:00Z): "),t("code",[s._v("<genesis_time>")])]),s._v(" "),t("li",[s._v("The new chain_id: "),t("code",[s._v("<new_chain_id>")])]),s._v(" "),t("li",[s._v("The old chain_id: "),t("code",[s._v("<old_chain_id>")])])]),s._v(" "),t("p",[s._v("If you are a validator, please make sure that you know all those information before proceeding with the update.")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("You should reach "),t("a",{attrs:{href:"#setup-height-to-stop-the-chain"}},[s._v("Setup height to stop the chain")]),s._v(" point before update event."),t("br"),s._v("\nYou prepare all settings as soon as you become aware of the update data")])]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[s._v("Double signing")]),s._v(" "),t("p",[s._v("Due to the nature of the update operations, there is some risk of double signature.\nTo avoid every sort of risks please verify the software version, the hash of the "),t("code",[s._v("genesis.json")]),s._v(" file and the specific\nconfiguration present inside the "),t("code",[s._v("config.toml")]),s._v(" file.")])]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[s._v("DANGER")]),s._v(" "),t("p",[s._v("Update time"),t("br"),s._v("\nThe deadline of the update must be respected: every validator that will not update just in time will be slashed as offline node.")])]),s._v(" "),t("h3",{attrs:{id:"install-support-software"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-support-software"}},[s._v("#")]),s._v(" Install support software")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" jq -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"setup-environment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setup-environment"}},[s._v("#")]),s._v(" Setup environment")]),s._v(" "),t("p",[s._v("Each validator has its own specific environment and therefore will have to modify the variables according to its setup."),t("br"),s._v(" "),t("strong",[s._v("The following setups are general guidelines")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UPDATE_PROFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v('/.profile_update_cnd"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export HOME_CND=\"'")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/.cnd\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export HOME_CND_CONFIG=\"$HOME_CND/config\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export HOME_CND_DATA=\"$HOME_CND/data\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export HOME_CNCLI=\"'")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/.cncli\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export APP_TOML=\"$HOME_CND_CONFIG/app.toml\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export BIN_DIR=\"'")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/go/bin\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export SRC_GIT_DIR=\"'")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/commercionetwork\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export BUILD_DIR=\"$SRC_GIT_DIR/build\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export NEW_CHAIN_ID=\"<new_chain_id>\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export CHAIN_ID=\"<old_chain_id>\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export BUILD_VERSION=\"<new_version>\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export ALT_BLOCK=<stop_block_height>'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export NEW_GENESIS_TIME=\"<genesis_time>\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('". '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.profile\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"compile-new-executables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#compile-new-executables"}},[s._v("#")]),s._v(" Compile new executables")]),s._v(" "),t("p",[s._v("In order to properly update your validator node, first of all you need to clone the\n"),t("a",{attrs:{href:"https://github.com/commercionetwork/commercionetwork",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("commercionetwork")]),s._v(" repo"),t("OutboundLink")],1),s._v(":")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/commercionetwork/commercionetwork.git "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SRC_GIT_DIR")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Once downloaded, you need to compile the binaries with correct version:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SRC_GIT_DIR")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUILD_VERSION")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" build\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("Verify your version")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./build/cnd version\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("should be the same value of "),t("code",[s._v("<new_version>")])]),s._v(" "),t("h3",{attrs:{id:"setup-height-to-stop-the-chain"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setup-height-to-stop-the-chain"}},[s._v("#")]),s._v(" Setup height to stop the chain")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|halt-height = .*|halt-height = '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ALT_BLOCK")]),s._v('|g"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v(".tmp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v(".tmp "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" cnd restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"control-if-chain-is-stopped"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#control-if-chain-is-stopped"}},[s._v("#")]),s._v(" Control if chain is stopped")]),s._v(" "),t("p",[s._v("After the block "),t("code",[s._v("<stop_block_height>")]),s._v(" a chain stop message should appear at the indicated block.\nTo verify that the chain is actually locked check with reading the logs")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl -u cnd -f\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"stop-services"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stop-services"}},[s._v("#")]),s._v(" Stop services")]),s._v(" "),t("p",[s._v("Make sure you have stopped services and export the chain")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop cnd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop cncli "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if you running rest server")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pkill")]),s._v(" cnd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pkill")]),s._v(" cncli\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("and control it reading the logs")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" journalctl -u cnd -f\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"export-chain-state"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#export-chain-state"}},[s._v("#")]),s._v(" Export chain state")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cnd "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" --for-zero-height "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/export_for_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(".json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"backup-executables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#backup-executables"}},[s._v("#")]),s._v(" Backup executables")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cnd "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cnd.back\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cncli "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cncli.back\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"changing-executables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changing-executables"}},[s._v("#")]),s._v(" Changing executables")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUILD_DIR")]),s._v("/cn* "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"migrate-chain"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#migrate-chain"}},[s._v("#")]),s._v(" Migrate chain")]),s._v(" "),t("p",[s._v("Try to find out migrate version from list of current migration")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cnd migrations-list \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("If you find "),t("code",[s._v("<new_version>")]),s._v(" in the ouput command you ca use the follow command")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cnd migrate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUILD_VERSION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/export_for_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(".json "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --chain-id "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("     \n  --genesis-time "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_GENESIS_TIME")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/genesis_for_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(".json\n  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("If you don't find "),t("code",[s._v("<new_version>")]),s._v(" in the valid migrations list use")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/export_for_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(".json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  jq "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.genesis_time=\"'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_GENESIS_TIME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  jq "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.chain_id=\"'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/genesis_for_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(".json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"check-hash-of-genesis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#check-hash-of-genesis"}},[s._v("#")]),s._v(" Check hash of genesis")]),s._v(" "),t("p",[s._v("To confirm that all validator nodes have produced the same genesis, a comparison must be made between all update participants to demonstrate the consistency of the data.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("jq -S -c -M "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/genesis_for_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(".json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" shasum -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Compare the value of the hash obtained with all other participants in the update")]),s._v(" "),t("h3",{attrs:{id:"backup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#backup"}},[s._v("#")]),s._v(" Backup")]),s._v(" "),t("p",[s._v("Before starting the update it is recommended to take a full data snapshot of the chain state at the export height."),t("br"),s._v("\nTo do so please run:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop cnd\nsystemctl stop cncli "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if you running rest server")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND_DATA")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("/.\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND_CONFIG")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("/.\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CNCLI")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CNCLI")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"reset-chain-and-change-geneis-file"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reset-chain-and-change-geneis-file"}},[s._v("#")]),s._v(" Reset chain and change geneis file")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cnd unsafe-reset-all\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/genesis_for_"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NEW_CHAIN_ID")]),s._v(".json "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND_CONFIG")]),s._v("/genesis.json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"restart-chain"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#restart-chain"}},[s._v("#")]),s._v(" Restart chain")]),s._v(" "),t("p",[s._v("Before restarting the chain we have to reset the value for height for the stop to zero.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s|halt-height = .*|halt-height = 0|g"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v(".tmp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v(".tmp "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APP_TOML")]),s._v("\nsystemctl start cnd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"control-chain-restart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#control-chain-restart"}},[s._v("#")]),s._v(" Control chain restart")]),s._v(" "),t("p",[s._v("The new chain should restart at the time set in the "),t("code",[s._v("genesis_time")]),s._v("."),t("br"),s._v("\nControl if the sync starts. Use "),t("code",[s._v("Ctrl + C")]),s._v(" to interrupt the "),t("code",[s._v("journalctl")]),s._v(" command")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("journalctl -u cnd -f\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OUTPUT SHOULD BE LIKE BELOW AFTER GENESI TIME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.722] Executed block                               module=state height=1 validTxs=0 invalidTxs=0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.728] Committed state                              module=state height=1 txs=0 appHash=9815044185EB222CE9084AA467A156DFE6B4A0B1BAAC6751DE86BB31C83C4B08")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.745] Executed block                               module=state height=2 validTxs=0 invalidTxs=0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.751] Committed state                              module=state height=2 txs=0 appHash=96BFD9C8714A79193A7913E5F091470691B195E1E6F028BC46D6B1423F7508A5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.771] Executed block                               module=state height=3 validTxs=0 invalidTxs=0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"restart-the-rest-api-if-you-need"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#restart-the-rest-api-if-you-need"}},[s._v("#")]),s._v(" Restart the REST API if you need")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cncli config chain-id $NEW_CHAIN_ID\ncncli rest-server --chain-id $NEW_CHAIN_ID --trust-node\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"update-type-2-soft-fork"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#update-type-2-soft-fork"}},[s._v("#")]),s._v(" Update type 2 - Soft fork")]),s._v(" "),t("p",[s._v("This type of upgrade is generally optional: it is released to fix some minor bugs in the software and does not change the status of the chain")]),s._v(" "),t("h3",{attrs:{id:"preliminary-risks-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preliminary-risks-2"}},[s._v("#")]),s._v(" Preliminary/Risks")]),s._v(" "),t("p",[s._v("When signalling a optional update that should follow this procedure, the following information will\nbe let known to all validators:")]),s._v(" "),t("ol",[t("li",[s._v("The new chain software version: "),t("code",[s._v("<new_version>")])])]),s._v(" "),t("p",[s._v("If you are a validator, please make sure that you know all those information before proceeding with the update.")]),s._v(" "),t("h3",{attrs:{id:"setup-environment-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setup-environment-2"}},[s._v("#")]),s._v(" Setup environment")]),s._v(" "),t("p",[s._v("Each validator has its own specific environment and therefore will have to modify the variables according to its setup."),t("br"),s._v(" "),t("strong",[s._v("The following setups are general guidelines")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UPDATE_PROFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v('/.profile_update_cnd"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export HOME_CND=\"'")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/.cnd\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export HOME_CND_CONFIG=\"$HOME_CND/config\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export HOME_CND_DATA=\"$HOME_CND/data\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export BIN_DIR=\"'")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/go/bin\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export SRC_GIT_DIR=\"'")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/commercionetwork\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export BUILD_DIR=\"$SRC_GIT_DIR/build\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export BUILD_VERSION=\"<new_version>\"'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('". '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$UPDATE_PROFILE")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.profile\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"compile-new-executables-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#compile-new-executables-2"}},[s._v("#")]),s._v(" Compile new executables")]),s._v(" "),t("p",[s._v("In order to properly update your validator node, first of all you need to clone the\n"),t("a",{attrs:{href:"https://github.com/commercionetwork/commercionetwork",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("commercionetwork")]),s._v(" repo"),t("OutboundLink")],1),s._v(":")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/commercionetwork/commercionetwork.git "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SRC_GIT_DIR")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Once downloaded, you need to compile the binaries with correct version:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SRC_GIT_DIR")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUILD_VERSION")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" build\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("Verify your version")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./build/cnd version\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("should be the same value of "),t("code",[s._v("<new_version>")])]),s._v(" "),t("h3",{attrs:{id:"backup-executables-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#backup-executables-2"}},[s._v("#")]),s._v(" Backup executables")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cnd "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cnd.back\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cncli "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cncli.back\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"restart-chain-changing-executables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#restart-chain-changing-executables"}},[s._v("#")]),s._v(" Restart chain changing executables")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop cnd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop cncli\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BUILD_DIR")]),s._v("/cn* "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/.\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start cnd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start cncli\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"control-chain-restart-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#control-chain-restart-2"}},[s._v("#")]),s._v(" Control chain restart")]),s._v(" "),t("p",[s._v("The new chain should restart at the time set in the "),t("code",[s._v("genesis_time")]),s._v("."),t("br"),s._v("\nControl if the sync starts. Use "),t("code",[s._v("Ctrl + C")]),s._v(" to interrupt the "),t("code",[s._v("journalctl")]),s._v(" command")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("journalctl -u cnd -f\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OUTPUT SHOULD BE LIKE BELOW AFTER GENESI TIME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.722] Executed block                               module=state height=1 validTxs=0 invalidTxs=0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.728] Committed state                              module=state height=1 txs=0 appHash=9815044185EB222CE9084AA467A156DFE6B4A0B1BAAC6751DE86BB31C83C4B08")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.745] Executed block                               module=state height=2 validTxs=0 invalidTxs=0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.751] Committed state                              module=state height=2 txs=0 appHash=96BFD9C8714A79193A7913E5F091470691B195E1E6F028BC46D6B1423F7508A5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Aug 13 16:30:20 commerciotestnet-node4 cnd[351]: I[2019-08-13|16:30:20.771] Executed block                               module=state height=3 validTxs=0 invalidTxs=0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"update-type-3-reset-reinstall-chain"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#update-type-3-reset-reinstall-chain"}},[s._v("#")]),s._v(" Update type 3 - Reset/reinstall chain")]),s._v(" "),t("p",[s._v("This procedure is very rare and is only performed in borderline cases."),t("br"),s._v("\nWith this process the chain is completely reinitialized and a new genesis is produced by the chain management system."),t("br"),s._v("\nUsually this procedure is applied on development and test chains.")]),s._v(" "),t("h3",{attrs:{id:"backup-executables-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#backup-executables-3"}},[s._v("#")]),s._v(" Backup executables")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cnd "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cnd.back\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cncli "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BIN_DIR")]),s._v("/cncli.back\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"backup-chain-database"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#backup-chain-database"}},[s._v("#")]),s._v(" Backup chain database")]),s._v(" "),t("p",[s._v("Before starting the update it is recommended to take a full data snapshot of the chain state at the export height."),t("br"),s._v("\nTo do so please run:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop cnd\nsystemctl stop cncli "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if you running rest server")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND_DATA")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("/.\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND_CONFIG")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CND")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("/.\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CNCLI")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HOME_CNCLI")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAIN_ID")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"reinstall-node"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reinstall-node"}},[s._v("#")]),s._v(" Reinstall node")]),s._v(" "),t("p",[s._v("Follow all steps in "),t("RouterLink",{attrs:{to:"/docs2.1.2/nodes/full-node-installation.html"}},[s._v("Installing a full node")]),t("br"),s._v("\nFollow all steps in "),t("RouterLink",{attrs:{to:"/docs2.1.2/nodes/validator-node-installation.html"}},[s._v("Becoming a validator")])],1)])}),[],!1,null,null,null);a.default=n.exports}}]);